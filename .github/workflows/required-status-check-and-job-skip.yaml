name: CI
on:
  pull_request: 
jobs:
  changed_directory:
    runs-on: ubuntu-latest
    outputs:
      frontend: ${{ steps.changed_directory.outputs.frontend }}
      backend: ${{ steps.changed_directory.outputs.backend }}
      renovate: ${{ steps.changed_directory.outputs.renovate }}
    steps:
      - uses: actions/checkout@v4
        with:
          filter: blob:none
          fetch-depth: 2 # ファイルの変更を取得するために必要
      - id: changed_directory
        env:
          TMP_FILE: ${{ runner.temp }}/changed_files.txt
        run: |
          git diff --name-only HEAD^ > $TMP_FILE
          grep --quiet '^frontend/' $TMP_FILE && echo "frontend=true" >> $GITHUB_OUTPUT
          grep --quiet '^backend/' $TMP_FILE && echo "backend=true" >> $GITHUB_OUTPUT
          grep --quiet '^renovate.json$' $TMP_FILE && echo "renovate=true" >> $GITHUB_OUTPUT
          cat $TMP_FILE # ファイルが変更されていない場合にエラーになるのを防ぐ

  frontend:
    runs-on: ubuntu-latest
    needs: changed_directory
    if: needs.changed_directory.outputs.frontend == 'true'
    steps:
      - run: echo "Frontend changed."
  backend:
    runs-on: ubuntu-latest
    needs: changed_directory
    if: needs.changed_directory.outputs.backend == 'true'
    steps:
      - run: echo "Backend changed."
  renovate:
    runs-on: ubuntu-latest
    needs: changed_directory
    if: needs.changed_directory.outputs.renovate == 'true'
    steps:
      - run: echo "Renovate config changed."
